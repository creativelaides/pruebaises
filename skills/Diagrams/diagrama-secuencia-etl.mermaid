sequenceDiagram
    actor Admin as ðŸ‘¨â€ðŸ’¼ Admin
    participant API as ðŸŒ EtlController
    participant Service as ðŸ’¼ SocrataEtlService
    participant Client as ðŸ”Œ SocrataClient
    participant Socrata as ðŸ›ï¸ datos.gov.co
    participant UoW as ðŸ—„ï¸ UnitOfWorkEFCore
    participant DB as ðŸ˜ PostgreSQL

    Admin->>+API: POST /api/etl/run (Bearer Token)
    API->>+Service: RunAsync()
    Service->>Service: Start timer + init EtlLog (Running)
    Service->>+UoW: EtlLogs.AddAsync(log)
    UoW->>+DB: INSERT etl_logs
    DB-->>-UoW: OK

    Note over Service: EXTRACT
    Service->>+Client: GetRowsAsync(pageSize)
    Client->>+Socrata: GET /resource/{dataset}.json
    Socrata-->>-Client: JSON rows
    Client-->>-Service: JsonElement[]

    Note over Service: TRANSFORM
    Service->>Service: Map + validate rows (TariffRow)
    Service->>Service: Upsert Company + ElectricityTariff

    Note over Service,DB: LOAD
    Service->>+UoW: ElectricityTariffs.Add/Update
    UoW->>+DB: INSERT/UPDATE tarifas
    DB-->>-UoW: OK

    Service->>Service: Stop timer
    Service->>+UoW: EtlLogs.UpdateAsync(Success)
    UoW->>+DB: UPDATE etl_logs
    DB-->>-UoW: OK

    Service-->>-API: EtlResult (Success)
    API-->>-Admin: 200 OK + summary
