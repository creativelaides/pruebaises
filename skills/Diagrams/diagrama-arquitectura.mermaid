---
config:
  layout: elk
---
flowchart RL
  subgraph Frontend["ğŸ¨ FRONTEND - Angular 20 (planificado)"]
    direction TB
    Features["ğŸ“¦ Features<br>- tariffs<br>- invoices<br>- admin/etl"]
    Core["ğŸ”§ Core<br>- api-clients<br>- guards"]
    Shared["ğŸ¤ Shared<br>- ui-components"]
  end

  subgraph Backend["ğŸ”§ BACKEND - .NET 10 Clean Architecture"]
    direction TB
    WebApi["ğŸŒ WebApi (Presentation)<br>- Controllers<br>- Exception Middleware<br>- AuthN/AuthZ"]
    Application["ğŸ’¼ Application (Use Cases)<br>- Commands/Queries<br>- Validators<br>- DTOs"]
    Domain["ğŸ›ï¸ Domain (Business Logic)<br>- Entities<br>- Value Objects<br>- Rules"]
    Infrastructure["ğŸ”© Infrastructure (External/Data)"]
    Persistence["ğŸ—„ï¸ Persistence<br>- TariffDbContext<br>- Repositories<br>- UnitOfWork"]
    Identity["ğŸ” Identity<br>- AppIdentityDbContext<br>- Policies/Claims<br>- Seed Users/Roles"]
    ExternalServices["ğŸŒ External Services<br>- SocrataClient (ETL)<br>- SmtpEmailService"]
  end

  subgraph External["ğŸŒ EXTERNOS"]
    Socrata["ğŸ›ï¸ datos.gov.co (Socrata API)"]
    PostgreSQL["ğŸ˜ PostgreSQL"]
    Smtp["âœ‰ï¸ SMTP (Gmail)"]
  end

  Frontend -- HTTP REST --> WebApi
  WebApi --> Application
  Application --> Domain
  Application --> Infrastructure
  Infrastructure --> Persistence
  Infrastructure --> Identity
  Infrastructure --> ExternalServices
  Persistence -- EF Core --> PostgreSQL
  Identity -- EF Core --> PostgreSQL
  ExternalServices -- HTTP GET --> Socrata
  ExternalServices -- SMTP --> Smtp

  style Frontend fill:#E3F2FD,stroke:#1976D2,stroke-width:3px
  style Features fill:#BBDEFB,stroke:#1976D2,stroke-width:2px
  style Core fill:#90CAF9,stroke:#1976D2,stroke-width:2px
  style Shared fill:#64B5F6,stroke:#1976D2,stroke-width:2px

  style WebApi fill:#E1BEE7,stroke:#7B1FA2,stroke-width:2px
  style Application fill:#CE93D8,stroke:#7B1FA2,stroke-width:2px
  style Domain fill:#BA68C8,stroke:#7B1FA2,stroke-width:2px
  style Infrastructure fill:#AB47BC,stroke:#7B1FA2,stroke-width:2px
  style Backend fill:#F3E5F5,stroke:#7B1FA2,stroke-width:3px

  style Socrata fill:#FFCC80,stroke:#F57C00,stroke-width:2px
  style PostgreSQL fill:#FFE0B2,stroke:#F57C00,stroke-width:2px
  style Smtp fill:#FFE0B2,stroke:#F57C00,stroke-width:2px
  style External fill:#FFF3E0,stroke:#F57C00,stroke-width:3px
